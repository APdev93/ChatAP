!function(){const e=document.getElementById("chat-container"),t=io();let n=[];const a=document.getElementById("imageInput");a.addEventListener("change",(function(){const e=a.files[0];e&&e.size>51200&&(a.value="",document.getElementById("top").style.display="none",alert("File terlalu besar! Maksimal ukuran file adalah 50KB."))}));document.getElementById("menuBtn").addEventListener("click",(()=>{alert("Fitur ini belum tersedia untuk anda!")})),document.getElementById("message-form").addEventListener("submit",(async function(e){e.preventDefault(),window.location.href="#chat";const t=document.getElementById("message");t.style.height="45px";const a=t.value,s=document.getElementById("imageInput").files[0];(new Date).toLocaleTimeString();let o,i=document.getElementById("btnSend");if(s){const e=new FileReader;e.onloadend=async function(){const s=e.result.replace("data:","").replace(/^.+,/,"");o={role:"user",content:{image:s,text:a}},n.push(o),p(n),t.value="",document.getElementById("imageInput").value="",document.getElementById("top").style.display="none",i.innerHTML='<span class="loading"></span>',i.setAttribute("disabled","true"),await h(a,o)},e.readAsDataURL(s)}else o={role:"user",content:a},n.push(o),p(n),t.value="",document.getElementById("imageInput").value="",i.innerHTML='<span class="loading"></span>',i.setAttribute("disabled","true"),await h(a,o)}));window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme");const s=document.getElementById("message");var o=s.style.height;s.addEventListener("input",(function(){this.value.includes("\n")?this.style.borderRadius="25px":this.style.borderRadius="50px",""===this.value?this.style.height=o:(this.style.height="auto",this.style.height="45px",this.style.height=this.scrollHeight+"px")}));const i=()=>{let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-";for(let n=0;n<10;n++)e+=t.charAt(Math.floor(63*Math.random()));return e},c=window.markdownit({highlight:function(e,t){let n=i();if(t&&window.hljs.getLanguage(t))try{return`<div class="codehead">\n\t<p>${t||"plaintext"}</p>\n\t<button onclick="copyCode('${n}')"><i class="fa-regular fa-copy"></i> salin</button>\n</div>\n<pre class="hljs">\n     <code id="${n}">${window.hljs.highlight(t,e,!0).value}</code>\n</pre>`}catch(e){}return`<div class="codehead">\n\t<p></p>\n\t<button onclick="copyCode()"><i class="fa-regular fa-copy"></i> salin</button>\n</div>\n<pre class="hljs">\n     <code id="code">${c.utils.escapeHtml(e)}</code>\n</pre>\n`}});function l(e){return c.render(e)}function d(t){const n=document.createElement("div");n.classList.add("chat-bubble"),n.classList.add("chat-receiver");const a=document.createElement("div");return a.classList.add("chat-content"),a.innerHTML=`<p class='err-msg'>${t}</p>`,n.appendChild(a),e.appendChild(n),n}function r(){document.querySelectorAll("a").forEach((function(e){e.style.color="#0484ff",(e.textContent.includes("[")&&e.textContent.includes("]")||e.textContent.includes("[[")&&e.textContent.includes("]]"))&&(e.textContent=e.textContent.replace("[","").replace("]",""),e.textContent=e.textContent.replace("[[","").replace("]]",""),e.style.textDecoration="none",e.style.backgroundColor="white",e.style.borderRadius="50px",e.style.paddingLeft="4.5px",e.style.paddingRight="4.5px",e.style.color="#0484ff",e.style.margin="0",e.style.verticalAlign="top",e.style.fontSize="11px",e.style.margin="3px",e.style.boxShadow="-3px -3px 7px #5e687960, 3px 3px 7px #5e687960")}))}function p(t){try{e.innerHTML="",t.forEach(((n,a)=>{const s=document.createElement("div");s.classList.add("chat-bubble"),"user"===n.role?s.classList.add("chat-sender"):s.classList.add("chat-receiver");const o=document.createElement("div");if(o.classList.add("chat-content"),"images"===n.role){const e=document.createElement("img");e.src=n.content,e.classList.add("chat-image"),o.appendChild(e),r()}else if("user"===n.role)if(console.log(n),n.content.image){console.log("message with image");const e=document.createElement("img");e.src=`data:image/png;base64,${n.content.image}`,o.appendChild(e),o.innerHTML+=n.content.text.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;nbsp;"),r()}else console.log("message without image"),o.innerHTML=n.content.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;nbsp;"),r();else if("user"!==n.role)if(r(),a===t.length-1){let t=0,a=l(n.content).split(" ");!function n(){var s=document.getElementById("btnSend");t<=a.length&&(o.innerHTML=a.slice(0,t).join(" "),t++,r(),window.scrollTo({top:e.scrollHeight,behavior:"smooth"}),t===a.length&&(s.innerHTML='<i class="fa-solid fa-arrow-up"></i>',s.disabled=!1),setTimeout(n,10))}()}else o.innerHTML=l(n.content),r();s.appendChild(o),e.appendChild(s)}))}catch(e){console.log(e)}}async function u(e,t={}){try{let n=await fetch("/callback",{method:"POST",headers:{"Content-Type":"application/json","X-Action":"Kh816hhfaDshbJDwJKoFsWhHBXVNanajNvyio=="===atob(e.msg)?"revalidate":"message",...t},body:JSON.stringify({msg:e})});return n.ok?await n.json():null}catch(e){return console.warn(e),null}}async function h(a,s){try{await async function(t){const n=document.createElement("div");n.classList.add("chat-bubble","chat-receiver");const a=document.createElement("div");a.classList.add("chat-content"),n.appendChild(a),e.appendChild(n);try{let e=await fetch("/check_prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t})});if(!e.ok)return a.innerHTML="",n;"imaging"===(await e.json()).cmd?a.innerHTML='\n                <div class="loading-img loading01">\n                    <span>I</span>\n                    <span>m</span>\n                    <span>a</span>\n                    <span>g</span>\n                    <span>i</span>\n                    <span>n</span>\n                    <span>i</span>\n                    <span>n</span>\n                    <span>g</span>\n                    <span>.</span>\n                    <span>.</span>\n                    <span>.</span>\n                </div>':a.innerHTML="<div class='loader'></div>"}catch(e){a.innerHTML=""}return n}(a)||d("Failed to processing message");let o=n.filter((e=>"images"!==e.role));window.location.href="#chat";const c=i(),l=await u({msg:btoa("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})).replace(/-/gi,c))},{"X-Id":c});if(l){if(s.content.image){s={role:"user",content:{image:pako.deflate(s.content.image,{to:"string"}),text:s.content.text}},console.log("Compresed data: ",s)}const e={coming:s,last:o,sessionHash:btoa(l.snd)};await t.emit(`chat ${l.snd}`,e)}else console.log("Callback data is null, cannot send message")}catch(e){d(e.message||e)}}window.hljs.highlightAll(),t.on("connect",(async function(){const e=await u({msg:btoa("Kh816hhfaDshbJDwJKoFsWhHBXVNanajNvyio==")});e?t.on(`chat ${e.rec}`,(async function(t){try{if(e.error)return window.alert("Error Occured");n.push(t),await p(n),window.location.href="#chat"}catch(e){d(e)}})):console.log("Callback data is null, cannot listen for messages")}))}();