const t=document.getElementById("chat-container"),n=io();let c=[];document.getElementById("message-form").addEventListener("submit",(async function(a){a.preventDefault(),window.location.href="#chat",e.style.height="45px";const o=document.getElementById("message").value,i=((new Date).toLocaleTimeString(),{role:"user",content:o});c.push(i),d(c),await async function(e){await function(){const n=document.createElement("div");n.classList.add("chat-bubble"),n.classList.add("chat-receiver");const c=document.createElement("div");return c.classList.add("chat-content"),c.innerHTML="<div class='loader'></div>",n.appendChild(c),t.appendChild(n),n}();try{window.location.href="#chat";const t=await r({t:"KuYTgKONk816_UFvJDwJKoFsWhHBXVNiRwAyKk=="});if(t){const a={o:e,i:c};await n.emit(`chat ${t.u}`,a)}}catch(t){s(t)}}(i),document.getElementById("message").value=""}));window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme");const e=document.getElementById("message");var a=e.style.height;e.addEventListener("input",(function(){this.value.includes("\n")?this.style.borderRadius="25px":this.style.borderRadius="50px",""===this.value?this.style.height=a:(this.style.height="auto",this.style.height="45px",this.style.height=this.scrollHeight+"px")}));const o=window.markdownit({h:function(t,n){let c=(()=>{let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-";for(let c=0;c<10;c++)t+=n.charAt(Math.floor(63*Math.random()));return t})();if(n&&window.hljs.getLanguage(n))try{return`<div class="codehead">\n\t<p>${n||"plaintext"}</p>\n\t<button onclick="copyCode('${c}')"><i class="fa-regular fa-copy"></i> salin</button>\n</div>\n<pre class="hljs">\n     <code id="${c}">${window.hljs.h(n,t,!0).value}</code>\n</pre>`}catch(t){}return`<div class="codehead">\n\t<p></p>\n\t<button onclick="copyCode()"><i class="fa-regular fa-copy"></i> salin</button>\n</div>\n<pre class="hljs">\n     <code id="code">${o.m.l(t)}</code>\n</pre>\n`}});function i(t){return o.p(t)}function s(n){const c=document.createElement("div");c.classList.add("chat-bubble"),c.classList.add("chat-receiver");const e=document.createElement("div");return e.classList.add("chat-content"),e.innerHTML=`<p class='err-msg'>${n}</p>`,c.appendChild(e),t.appendChild(c),c}function d(n){try{t.innerHTML="",n.forEach(((c,e)=>{const a=document.createElement("div");a.classList.add("chat-bubble"),"user"===c.role?a.classList.add("chat-sender"):a.classList.add("chat-receiver");const o=document.createElement("div");if(o.classList.add("chat-content"),"images"===c.role){const t=document.createElement("img");t.src=c.content,t.classList.add("chat-image"),o.appendChild(t)}else if("user"===c.role)o.innerHTML=c.content.replace(/\n/g,"<br>");else if("user"!==c.role)if(e===n.length-1){let n=0,e=i(c.content).split(" ");!function c(){var a=document.getElementById("btnSend");n<=e.length&&(o.innerHTML=e.slice(0,n).join(" "),n++,window.scrollTo({top:t.scrollHeight,behavior:"smooth"}),1===n?(a.innerHTML='<span class="loading"></span>',a.setAttribute("disabled","true")):n===e.length&&(a.innerHTML='<i class="fa-solid fa-arrow-up"></i>',a.disabled=!1),setTimeout(c,10))}()}else o.innerHTML=i(c.content);a.appendChild(o),t.appendChild(a)}))}catch(t){}}async function r(t){try{let n=await fetch("/callback",{method:"POST",headers:{v:"application/json"},body:JSON.stringify({t:t})});return n.ok?await n.json():null}catch(t){return null}}window.hljs.highlightAll(),n.on("connect",(async function(){const t=await r({t:"Kh816hhfaDshbJDwJKoFsWhHBXVNanajNvyio=="});t&&n.on(`chat ${t.k}`,(async function(t){try{c.push(t),await d(c),window.location.href="#chat"}catch(t){s(t)}}))}));